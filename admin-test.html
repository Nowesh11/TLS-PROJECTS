<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel Test Suite</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h2 {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .test-item {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-left: 4px solid #007bff;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.pass {
            background: #d4edda;
            color: #155724;
        }
        .status.fail {
            background: #f8d7da;
            color: #721c24;
        }
        .status.pending {
            background: #fff3cd;
            color: #856404;
        }
        .results {
            margin-top: 20px;
            padding: 15px;
            background: #e9ecef;
            border-radius: 5px;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Admin Panel Comprehensive Test Suite</h1>
        <p>This test suite validates all major admin panel functionalities after recent fixes.</p>
        
        <div class="test-section">
            <h2>1. Form Builder Tests</h2>
            <div class="test-item">
                <strong>Individual Form Builder Availability:</strong>
                <button class="test-button" onclick="testFormBuilder()">Test Form Builder</button>
                <span id="form-builder-status" class="status pending">PENDING</span>
            </div>
            <div class="test-item">
                <strong>Form Editor Modal Z-Index:</strong>
                <button class="test-button" onclick="testModalZIndex()">Test Modal Z-Index</button>
                <span id="modal-zindex-status" class="status pending">PENDING</span>
            </div>
            <div class="test-item">
                <strong>Mobile Responsiveness:</strong>
                <button class="test-button" onclick="testMobileResponsiveness()">Test Mobile View</button>
                <span id="mobile-responsive-status" class="status pending">PENDING</span>
            </div>
        </div>

        <div class="test-section">
            <h2>2. Edit Button Tests</h2>
            <div class="test-item">
                <strong>Project Edit Button:</strong>
                <button class="test-button" onclick="testEditButton('project')">Test Project Edit</button>
                <span id="project-edit-status" class="status pending">PENDING</span>
            </div>
            <div class="test-item">
                <strong>Ebook Edit Button:</strong>
                <button class="test-button" onclick="testEditButton('ebook')">Test Ebook Edit</button>
                <span id="ebook-edit-status" class="status pending">PENDING</span>
            </div>
            <div class="test-item">
                <strong>Poster Edit Button:</strong>
                <button class="test-button" onclick="testEditButton('poster')">Test Poster Edit</button>
                <span id="poster-edit-status" class="status pending">PENDING</span>
            </div>
        </div>

        <div class="test-section">
            <h2>3. Form Management Tests</h2>
            <div class="test-item">
                <strong>Individual Form Manager Authentication:</strong>
                <button class="test-button" onclick="testFormManagerAuth()">Test Auth Fix</button>
                <span id="form-manager-auth-status" class="status pending">PENDING</span>
            </div>
            <div class="test-item">
                <strong>Form Management Navigation:</strong>
                <button class="test-button" onclick="testFormManagementNav()">Test Navigation</button>
                <span id="form-management-nav-status" class="status pending">PENDING</span>
            </div>
        </div>

        <div class="test-section">
            <h2>4. Admin Panel Integration Test</h2>
            <div class="test-item">
                <strong>Load Admin Panel:</strong>
                <button class="test-button" onclick="loadAdminPanel()">Load Admin Panel</button>
                <span id="admin-panel-status" class="status pending">PENDING</span>
            </div>
            <iframe id="admin-frame" src="about:blank" style="display: none;"></iframe>
        </div>

        <div class="results" id="test-results">
            <h3>Test Results Summary</h3>
            <p>Click the test buttons above to run individual tests. Results will appear here.</p>
        </div>
    </div>

    <script>
        let testResults = {};
        
        function updateStatus(testId, status, message = '') {
            const statusElement = document.getElementById(testId + '-status');
            statusElement.className = `status ${status}`;
            statusElement.textContent = status.toUpperCase();
            if (message) {
                statusElement.title = message;
            }
            testResults[testId] = { status, message };
            updateResultsSummary();
        }
        
        function updateResultsSummary() {
            const resultsDiv = document.getElementById('test-results');
            const passed = Object.values(testResults).filter(r => r.status === 'pass').length;
            const failed = Object.values(testResults).filter(r => r.status === 'fail').length;
            const total = Object.keys(testResults).length;
            
            resultsDiv.innerHTML = `
                <h3>Test Results Summary</h3>
                <p><strong>Total Tests:</strong> ${total}</p>
                <p><strong>Passed:</strong> <span style="color: green;">${passed}</span></p>
                <p><strong>Failed:</strong> <span style="color: red;">${failed}</span></p>
                <p><strong>Success Rate:</strong> ${total > 0 ? Math.round((passed / total) * 100) : 0}%</p>
            `;
        }
        
        function testFormBuilder() {
            try {
                // Test if IndividualFormBuilder is available globally
                if (typeof window.IndividualFormBuilder !== 'undefined') {
                    updateStatus('form-builder', 'pass', 'IndividualFormBuilder is globally available');
                } else {
                    // Try to load it from the admin panel
                    const frame = document.getElementById('admin-frame');
                    frame.src = 'http://localhost:8080/admin.html';
                    frame.onload = () => {
                        try {
                            const frameWindow = frame.contentWindow;
                            if (frameWindow.IndividualFormBuilder) {
                                updateStatus('form-builder', 'pass', 'IndividualFormBuilder loaded in admin panel');
                            } else {
                                updateStatus('form-builder', 'fail', 'IndividualFormBuilder not found');
                            }
                        } catch (e) {
                            updateStatus('form-builder', 'fail', 'Cross-origin access denied');
                        }
                    };
                }
            } catch (error) {
                updateStatus('form-builder', 'fail', error.message);
            }
        }
        
        function testModalZIndex() {
            // This test checks if the modal z-index fix is applied
            fetch('/css/individual-form-editor.css')
                .then(response => response.text())
                .then(css => {
                    if (css.includes('z-index: 10000')) {
                        updateStatus('modal-zindex', 'pass', 'Modal z-index set to 10000');
                    } else {
                        updateStatus('modal-zindex', 'fail', 'Modal z-index not updated');
                    }
                })
                .catch(error => {
                    updateStatus('modal-zindex', 'fail', error.message);
                });
        }
        
        function testMobileResponsiveness() {
            // Test mobile responsive CSS
            fetch('/css/individual-form-editor.css')
                .then(response => response.text())
                .then(css => {
                    if (css.includes('@media (max-width: 480px)') && css.includes('width: 100vw')) {
                        updateStatus('mobile-responsive', 'pass', 'Mobile responsive styles found');
                    } else {
                        updateStatus('mobile-responsive', 'fail', 'Mobile responsive styles missing');
                    }
                })
                .catch(error => {
                    updateStatus('mobile-responsive', 'fail', error.message);
                });
        }
        
        function testEditButton(type) {
            // Test if edit functions are available
            const frame = document.getElementById('admin-frame');
            frame.src = 'http://localhost:8080/admin.html';
            frame.style.display = 'block';
            
            frame.onload = () => {
                try {
                    const frameWindow = frame.contentWindow;
                    let functionName;
                    
                    switch(type) {
                        case 'project':
                            functionName = 'editProject';
                            break;
                        case 'ebook':
                            functionName = 'editEbook';
                            break;
                        case 'poster':
                            functionName = 'editPoster';
                            break;
                    }
                    
                    if (frameWindow[functionName] && typeof frameWindow[functionName] === 'function') {
                        updateStatus(type + '-edit', 'pass', `${functionName} function is available`);
                    } else {
                        updateStatus(type + '-edit', 'fail', `${functionName} function not found`);
                    }
                } catch (e) {
                    updateStatus(type + '-edit', 'fail', 'Cross-origin access denied');
                }
            };
        }
        
        function testFormManagerAuth() {
            // Test if the authentication fix is applied
            fetch('/js/individual-form-manager.js')
                .then(response => response.text())
                .then(js => {
                    if (js.includes('adminToken') && js.includes('|| localStorage.getItem(\'token\')')) {
                        updateStatus('form-manager-auth', 'pass', 'Authentication fix applied');
                    } else {
                        updateStatus('form-manager-auth', 'fail', 'Authentication fix not found');
                    }
                })
                .catch(error => {
                    updateStatus('form-manager-auth', 'fail', error.message);
                });
        }
        
        function testFormManagementNav() {
            // Test if form management navigation functions exist
            const frame = document.getElementById('admin-frame');
            frame.src = 'http://localhost:8080/admin.html';
            
            frame.onload = () => {
                try {
                    const frameWindow = frame.contentWindow;
                    if (frameWindow.showSection && frameWindow.loadIndividualFormManager) {
                        updateStatus('form-management-nav', 'pass', 'Navigation functions available');
                    } else {
                        updateStatus('form-management-nav', 'fail', 'Navigation functions missing');
                    }
                } catch (e) {
                    updateStatus('form-management-nav', 'fail', 'Cross-origin access denied');
                }
            };
        }
        
        function loadAdminPanel() {
            const frame = document.getElementById('admin-frame');
            frame.src = 'http://localhost:8080/admin.html';
            frame.style.display = 'block';
            
            frame.onload = () => {
                updateStatus('admin-panel', 'pass', 'Admin panel loaded successfully');
            };
            
            frame.onerror = () => {
                updateStatus('admin-panel', 'fail', 'Failed to load admin panel');
            };
        }
        
        // Auto-run some basic tests on page load
        window.onload = () => {
            setTimeout(() => {
                testModalZIndex();
                testMobileResponsiveness();
                testFormManagerAuth();
            }, 1000);
        };
    </script>
</body>
</html>