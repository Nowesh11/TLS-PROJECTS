<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-content="ebooks.meta.title" data-content-tamil="ebooks.meta.titleTamil">Digital Library - Tamil Language Society</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Noto+Sans+Tamil:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css?v=10.0">
    <link rel="stylesheet" href="css/responsive.css?v=10.0">
    <link rel="stylesheet" href="css/animations.css?v=10.0">
    <link rel="stylesheet" href="css/slideshow.css?v=10.0">
    <link rel="stylesheet" href="css/css-priority-fixes.css?v=10.0">
    
    <style>
        /* Modern Design System - Ebooks Page */
        :root {
            --primary-blue: #2563eb;
            --secondary-blue: #1d4ed8;
            --accent-green: #10b981;
            --accent-purple: #8b5cf6;
            --accent-gold: #f59e0b;
            --accent-orange: #f97316;
            --accent-red: #ef4444;
            --text-dark: #1f2937;
            --text-muted: #6b7280;
            --bg-light: #f8fafc;
            --bg-white: #ffffff;
            --border-light: #e5e7eb;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            --gradient-primary: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
            --gradient-accent: linear-gradient(135deg, var(--accent-green), var(--accent-purple));
            --border-radius: 0.75rem;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        [data-theme="dark"] {
            --text-dark: #f9fafb;
            --text-muted: #d1d5db;
            --bg-light: #111827;
            --bg-white: #1f2937;
            --border-light: #374151;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background: var(--bg-light);
            margin: 0;
            padding: 0;
            transition: var(--transition);
        }

        /* Navigation */
        .navbar {
            background: var(--bg-white);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-light);
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: 1000;
            transition: var(--transition);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 70px;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-decoration: none;
        }

        .nav-menu {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
            gap: 2rem;
        }

        .nav-link {
            color: var(--text-dark);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            position: relative;
        }

        .nav-link:hover {
            color: var(--primary-blue);
        }

        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--gradient-primary);
            border-radius: 1px;
        }

        .theme-toggle {
            background: var(--bg-light);
            border: 1px solid var(--border-light);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-dark);
        }

        .theme-toggle:hover {
            background: var(--primary-blue);
            color: white;
            transform: scale(1.05);
        }

        /* Language Toggle */
        .language-toggle {
            display: flex;
            background: var(--bg-white);
            border: 1px solid var(--border-light);
            border-radius: 2rem;
            overflow: hidden;
        }
        
        .lang-btn {
            background: none;
            border: none;
            padding: 0.5rem 1rem;
            color: var(--text-muted);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }
        
        .lang-btn.active {
            background: var(--gradient-primary);
            color: white;
        }
        
        .lang-btn:hover:not(.active) {
            background: var(--bg-light);
            color: var(--text-dark);
        }

        /* Hero Section */
        .hero {
            background: var(--gradient-primary);
            color: white;
            padding: 4rem 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 100" fill="%23ffffff" opacity="0.1"><polygon points="1000,100 1000,0 0,100"/></svg>') no-repeat center bottom;
            background-size: cover;
        }

        .hero-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 1rem;
            position: relative;
            z-index: 1;
        }

        .hero h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 1rem;
            line-height: 1.2;
        }

        .hero p {
            font-size: 1.25rem;
            opacity: 0.9;
            margin-bottom: 2rem;
        }

        /* Sections */
        .section {
            padding: 4rem 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .section-title {
            text-align: center;
            margin-bottom: 3rem;
        }

        .section-title h2 {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 1rem;
        }

        .section-title p {
            font-size: 1.125rem;
            color: var(--text-muted);
            max-width: 600px;
            margin: 0 auto;
        }

        /* Search and Filter Section */
        .search-section {
            background: var(--bg-white);
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-light);
        }

        .search-bar {
            position: relative;
            margin-bottom: 2rem;
        }

        .search-bar input {
            width: 100%;
            padding: 1rem 3rem 1rem 1rem;
            border: 2px solid var(--border-light);
            border-radius: 2rem;
            font-size: 1rem;
            transition: var(--transition);
            background: var(--bg-white);
            color: var(--text-dark);
        }

        .search-bar input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .search-btn {
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .search-btn:hover {
            transform: translateY(-50%) scale(1.05);
            box-shadow: var(--shadow-lg);
        }

        .filter-section {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .filter-section select {
            padding: 0.75rem 1rem;
            border: 2px solid var(--border-light);
            border-radius: var(--border-radius);
            background: var(--bg-white);
            color: var(--text-dark);
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .filter-section select:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* Book Cards */
        .ebook-card, .book-card {
            background: var(--bg-white);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-md);
            transition: var(--transition);
            border: 1px solid var(--border-light);
        }

        .ebook-card:hover, .book-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl);
        }

        .book-cover {
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .book-info {
            padding: 1.5rem;
            background: var(--bg-white);
        }

        .book-info h4 {
            color: var(--text-dark);
            margin-bottom: 0.5rem;
            font-size: 1.125rem;
            font-weight: 600;
        }

        .book-info p {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .rating {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            color: var(--accent-gold);
        }

        .rating span {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* Category Cards */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
        }

        .category-card {
            background: var(--bg-white);
            padding: 2.5rem 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid var(--border-light);
        }

        .category-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl);
        }

        .category-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            color: white;
            font-size: 2rem;
        }

        .category-card h3 {
            color: var(--text-dark);
            margin-bottom: 1rem;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .category-card p {
            color: var(--text-muted);
            margin-bottom: 1rem;
        }

        .category-card span {
            font-weight: 600;
        }

        /* Carousel */
        .ebooks-carousel {
            position: relative;
            overflow: hidden;
            margin-bottom: 3rem;
        }

        .carousel-container {
            display: flex;
            transition: transform 0.5s ease;
        }

        .carousel-prev, .carousel-next {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
            color: var(--text-dark);
        }

        .carousel-prev {
            left: 1rem;
        }

        .carousel-next {
            right: 1rem;
        }

        .carousel-prev:hover, .carousel-next:hover {
            background: var(--primary-blue);
            color: white;
            transform: translateY(-50%) scale(1.1);
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-download {
            background: var(--primary-blue);
            color: white;
            border: none;
            padding: 0.75rem 1rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .btn-download:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-rate {
            background: var(--accent-gold);
            color: white;
            border: none;
            padding: 0.75rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .btn-rate:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* Statistics Section */
        .stats {
            background: var(--text-dark);
            color: white;
            padding: 4rem 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 3rem;
            font-weight: 700;
            background: var(--gradient-accent);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 1.125rem;
            opacity: 0.9;
        }

        /* Footer */
        .footer {
            background: var(--text-dark);
            color: white;
            padding: 3rem 0 1rem;
            margin-top: 4rem;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .footer-section h3 {
            margin-bottom: 1rem;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .footer-section ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .footer-section ul li {
            margin-bottom: 0.5rem;
        }

        .footer-section ul li a {
            color: #d1d5db;
            text-decoration: none;
            transition: var(--transition);
        }

        .footer-section ul li a:hover {
            color: var(--accent-green);
        }

        .footer-bottom {
            border-top: 1px solid #374151;
            padding-top: 1rem;
            text-align: center;
            color: #9ca3af;
        }

        /* Notification Toast */
        .notification-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-white);
            border: 1px solid var(--border-light);
            border-radius: var(--border-radius);
            padding: 1rem 1.5rem;
            box-shadow: var(--shadow-xl);
            z-index: 10000;
            transform: translateX(400px);
            transition: var(--transition);
            max-width: 400px;
        }

        .notification-toast.show {
            transform: translateX(0);
        }

        .notification-toast.success {
            border-left: 4px solid var(--accent-green);
        }

        .notification-toast.error {
            border-left: 4px solid #ef4444;
        }

        /* Rating Modal */
        .rating-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .rating-modal > div {
            background: var(--bg-white);
            padding: 2rem;
            border-radius: var(--border-radius);
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: var(--shadow-xl);
        }

        .rating-stars {
            margin-bottom: 1.5rem;
            font-size: 2rem;
            color: var(--text-muted);
        }

        .rating-stars i {
            cursor: pointer;
            transition: var(--transition);
        }

        .rating-stars i:hover {
            transform: scale(1.1);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }

            .section-title h2 {
                font-size: 2rem;
            }

            .nav-menu {
                display: none;
            }

            .filter-section {
                flex-direction: column;
                align-items: center;
            }

            .filter-section select {
                width: 100%;
                max-width: 300px;
            }

            .category-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .footer-content {
                grid-template-columns: 1fr;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            .hero {
                padding: 2rem 0;
            }

            .hero h1 {
                font-size: 1.75rem;
            }

            .section {
                padding: 2rem 0;
            }

            .search-section {
                padding: 1.5rem;
            }

            .category-card {
                padding: 2rem 1.5rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
    
    <!-- API Integration -->
    <script src="js/api-integration.js?v=6.0"></script>
    <!-- Authentication -->
    <script src="js/auth.js?v=8.0"></script>
    <script src="js/auth-utils.js"></script>

</head>
<body>
    <!-- Theme Toggle -->
    <div class="theme-toggle">
        <button onclick="toggleTheme()" title="Toggle Theme" aria-label="Toggle between light and dark theme">
            <i id="theme-icon" class="fas fa-moon"></i>
        </button>
    </div>

    <!-- Navigation Bar -->
    <nav class="navbar" id="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <img data-content="global.logo.image" src="assets/logo.jpeg" alt="Tamil Language Society" class="logo-img">
                <span data-content="global.logo.text" data-content-tamil="global.logo.textTamil" class="logo-text">தமிழ்ப் பேரவை</span>
            </div>
            
            <div class="nav-menu" id="nav-menu">
                <a href="index.html" class="nav-link" data-content="global.menu.home" data-content-tamil="global.menu.homeTamil" data-content-url="global.menu.homeUrl">Home</a>
                <a href="about.html" class="nav-link" data-content="global.menu.about" data-content-tamil="global.menu.aboutTamil" data-content-url="global.menu.aboutUrl">About Us</a>
                <a href="projects.html" class="nav-link" data-content="global.menu.projects" data-content-tamil="global.menu.projectsTamil" data-content-url="global.menu.projectsUrl">Projects</a>
                <a href="ebooks.html" class="nav-link active" data-content="global.menu.ebooks" data-content-tamil="global.menu.ebooksTamil" data-content-url="global.menu.ebooksUrl">Ebooks</a>
                <a href="books.html" class="nav-link" data-content="global.menu.bookstore" data-content-tamil="global.menu.bookstoreTamil" data-content-url="global.menu.bookstoreUrl">Book Store</a>
                <a href="contact.html" class="nav-link" data-content="global.menu.contact" data-content-tamil="global.menu.contactTamil" data-content-url="global.menu.contactUrl">Contact Us</a>

                <a href="notifications.html" class="nav-link notification-icon">
                    <i class="fas fa-bell"></i>
                    <span class="notification-dot" id="notification-dot"></span>
                </a>
                <a href="login.html" class="nav-link" data-content="global.menu.login" data-content-tamil="global.menu.loginTamil" data-content-url="global.menu.loginUrl">Login</a>
                <a href="signup.html" class="nav-link signup-btn" data-content="global.menu.signup" data-content-tamil="global.menu.signupTamil" data-content-url="global.menu.signupUrl">Sign Up</a>
                
                <!-- Language Toggle -->
                <div class="language-toggle" id="language-toggle">
                    <button class="lang-btn active" data-lang="en" title="English">EN</button>
                    <button class="lang-btn" data-lang="ta" title="தமிழ்">த</button>
                </div>
            </div>
            
            <div class="hamburger" id="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero" style="min-height: 60vh;">
        <div class="hero-background">
            <div class="hero-gradient"></div>
            <div class="hero-pattern"></div>
        </div>
        
        <div class="hero-content">
            <div class="hero-text" style="text-align: center; max-width: 800px; margin: 0 auto;">
                <h1 class="hero-title">
                    <span data-content="ebooks.hero.title" class="english-title">Digital Library</span>
                    <span data-content="ebooks.hero.titleTamil" class="tamil-title tamil-text">மின்னூல் நூலகம்</span>
                </h1>
                <p data-content="ebooks.hero.subtitle" class="hero-subtitle">
                    Explore our vast collection of Tamil literature, educational resources, and cultural treasures
                </p>
                <p data-content="ebooks.hero.quote" data-content-tamil="ebooks.hero.quoteTamil" class="tamil-quote">
                    "நூல் நுணுக்கம் இல்லாதவர் அறிவில் மழுங்கியவர்"
                </p>
            </div>
        </div>
    </section>

    <!-- Search and Filter Section -->
    <section class="features" style="padding-top: 2rem;">
        <div class="container">
            <div class="search-section" style="max-width: 800px; margin: 0 auto;">
                <div class="search-bar" style="position: relative; margin-bottom: 2rem;">
                    <input type="text" id="search-input" data-content="ebooks.search.placeholder" placeholder="Search for books, authors, or topics..." style="width: 100%; padding: 1rem 3rem 1rem 1rem; border: 2px solid var(--gray-200); border-radius: 2rem; font-size: 1rem; transition: border-color 0.3s ease;">
                    <button class="search-btn" style="position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%); background: var(--primary-blue); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 1.5rem; cursor: pointer;">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                
                <div class="filter-section" style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                    <select id="category-filter" style="padding: 0.5rem 1rem; border: 2px solid var(--border-secondary, #4B5563); border-radius: 0.5rem; background: var(--bg-secondary, #ffffff); color: var(--text-primary, #333333); transition: all 0.3s ease;">
                        <option value="all" data-content="ebooks.filters.allCategories">All Categories</option>
                        <option value="literature" data-content="ebooks.filters.literature">Literature</option>
                        <option value="education" data-content="ebooks.filters.education">Education</option>
                        <option value="culture" data-content="ebooks.filters.culture">Culture</option>
                        <option value="history" data-content="ebooks.filters.history">History</option>
                        <option value="poetry" data-content="ebooks.filters.poetry">Poetry</option>
                        <option value="children" data-content="ebooks.filters.children">Children's Books</option>
                    </select>
                    
                    <select id="language-filter" style="padding: 0.5rem 1rem; border: 2px solid var(--border-secondary, #4B5563); border-radius: 0.5rem; background: var(--bg-secondary, #ffffff); color: var(--text-primary, #333333); transition: all 0.3s ease;">
                        <option value="all" data-content="ebooks.filters.allLanguages">All Languages</option>
                        <option value="tamil" data-content="ebooks.filters.tamilOnly">Tamil Only</option>
                        <option value="bilingual" data-content="ebooks.filters.bilingual">Tamil-English</option>
                        <option value="english" data-content="ebooks.filters.english">English Translation</option>
                    </select>
                    
                    <select id="sort-filter" style="padding: 0.5rem 1rem; border: 2px solid var(--border-secondary, #4B5563); border-radius: 0.5rem; background: var(--bg-secondary, #ffffff); color: var(--text-primary, #333333); transition: all 0.3s ease;">
                        <option value="latest" data-content="ebooks.filters.latest">Latest First</option>
                        <option value="popular" data-content="ebooks.filters.popular">Most Popular</option>
                        <option value="alphabetical" data-content="ebooks.filters.alphabetical">A-Z</option>
                        <option value="rating" data-content="ebooks.filters.rating">Highest Rated</option>
                    </select>
                </div>
            </div>
        </div>
    </section>

    <!-- Featured Books -->
    <section class="features">
        <div class="container">
            <h2 class="section-title">
                <span data-content="ebooks.featured.title" class="english">Featured Books</span>
                <span data-content="ebooks.featured.titleTamil" class="tamil tamil-text">சிறப்பு நூல்கள்</span>
            </h2>
            
            <div class="ebooks-carousel" style="position: relative; overflow: hidden; margin-bottom: 3rem;">
                <div class="carousel-container" id="featured-carousel" style="display: flex; transition: transform 0.5s ease;">
                    <!-- Featured Book 1 -->
                    <div class="ebook-card featured" style="min-width: 300px; margin-right: 2rem;">
                        <div class="book-cover" style="height: 400px; ${getEbookImageStyle('linear-gradient(135deg, #8b5cf6, #7c3aed)')}; border-radius: 1rem; position: relative; overflow: hidden; box-shadow: var(--shadow-xl);">
                            <div style="position: absolute; top: 2rem; left: 2rem; right: 2rem; text-align: center; color: white;">
                                <h3 style="font-family: 'Noto Sans Tamil', var(--font-tamil), sans-serif; font-size: 1.5rem; margin-bottom: 1rem; font-weight: 600;">திருக்குறள்</h3>
                                <p style="font-size: 1rem; opacity: 0.9;">திருவள்ளுவர்</p>
                                <div style="position: absolute; bottom: -200px; left: 50%; transform: translateX(-50%); font-size: 8rem; opacity: 0.1;">
                                    <i class="fas fa-book-open"></i>
                                </div>
                            </div>
                        </div>
                        <div class="book-info" style="padding: 1.5rem; background: white; border-radius: 0 0 1rem 1rem; box-shadow: var(--shadow-lg);">
                            <h4 style="color: var(--gray-900); margin-bottom: 0.5rem;">Thirukkural</h4>
                            <p style="color: var(--gray-600); font-size: 0.9rem; margin-bottom: 1rem;">Classic Tamil literature on ethics and morality</p>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div class="rating" style="color: var(--accent-gold);">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <span style="margin-left: 0.5rem; color: var(--gray-600);">4.9</span>
                                </div>
                                <button class="btn-download" style="background: var(--primary-blue); color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-size: 0.9rem;">
                                    <i class="fas fa-download"></i> Download
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Featured Book 2 -->
                    <div class="ebook-card featured" style="min-width: 300px; margin-right: 2rem;">
                        <div class="book-cover" style="height: 400px; ${getEbookImageStyle('linear-gradient(135deg, #f59e0b, #f97316)')}; border-radius: 1rem; position: relative; overflow: hidden; box-shadow: var(--shadow-xl);">
                            <div style="position: absolute; top: 2rem; left: 2rem; right: 2rem; text-align: center; color: white;">
                                <h3 style="font-family: 'Noto Sans Tamil', var(--font-tamil), sans-serif; font-size: 1.5rem; margin-bottom: 1rem; font-weight: 600;">சிலப்பதிகாரம்</h3>
                                <p style="font-size: 1rem; opacity: 0.9;">இளங்கோ அடிகள்</p>
                                <div style="position: absolute; bottom: -200px; left: 50%; transform: translateX(-50%); font-size: 8rem; opacity: 0.1;">
                                    <i class="fas fa-scroll"></i>
                                </div>
                            </div>
                        </div>
                        <div class="book-info" style="padding: 1.5rem; background: white; border-radius: 0 0 1rem 1rem; box-shadow: var(--shadow-lg);">
                            <h4 style="color: var(--gray-900); margin-bottom: 0.5rem;">Silappatikaram</h4>
                            <p style="color: var(--gray-600); font-size: 0.9rem; margin-bottom: 1rem;">Ancient Tamil epic poem</p>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div class="rating" style="color: var(--accent-gold);">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <span style="margin-left: 0.5rem; color: var(--gray-600);">4.8</span>
                                </div>
                                <button class="btn-download" style="background: var(--accent-gold); color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-size: 0.9rem;">
                                    <i class="fas fa-download"></i> Download
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Featured Book 3 -->
                    <div class="ebook-card featured" style="min-width: 300px; margin-right: 2rem;">
                        <div class="book-cover" style="height: 400px; ${getEbookImageStyle('linear-gradient(135deg, #10b981, #059669)')}; border-radius: 1rem; position: relative; overflow: hidden; box-shadow: var(--shadow-xl);">
                            <div style="position: absolute; top: 2rem; left: 2rem; right: 2rem; text-align: center; color: white;">
                                <h3 style="font-family: 'Noto Sans Tamil', var(--font-tamil), sans-serif; font-size: 1.5rem; margin-bottom: 1rem; font-weight: 600;">தமிழ் இலக்கணம்</h3>
                                <p style="font-size: 1rem; opacity: 0.9;">தொல்காப்பியர்</p>
                                <div style="position: absolute; bottom: -200px; left: 50%; transform: translateX(-50%); font-size: 8rem; opacity: 0.1;">
                                    <i class="fas fa-language"></i>
                                </div>
                            </div>
                        </div>
                        <div class="book-info" style="padding: 1.5rem; background: white; border-radius: 0 0 1rem 1rem; box-shadow: var(--shadow-lg);">
                            <h4 style="color: var(--gray-900); margin-bottom: 0.5rem;">Tamil Grammar</h4>
                            <p style="color: var(--gray-600); font-size: 0.9rem; margin-bottom: 1rem;">Comprehensive guide to Tamil language structure</p>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div class="rating" style="color: var(--accent-gold);">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="far fa-star"></i>
                                    <span style="margin-left: 0.5rem; color: var(--gray-600);">4.6</span>
                                </div>
                                <button class="btn-download" style="background: var(--accent-green); color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-size: 0.9rem;">
                                    <i class="fas fa-download"></i> Download
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button class="carousel-prev" style="position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); background: rgba(255, 255, 255, 0.9); border: none; border-radius: 50%; width: 50px; height: 50px; cursor: pointer; box-shadow: var(--shadow-lg);">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button class="carousel-next" style="position: absolute; right: 1rem; top: 50%; transform: translateY(-50%); background: rgba(255, 255, 255, 0.9); border: none; border-radius: 50%; width: 50px; height: 50px; cursor: pointer; box-shadow: var(--shadow-lg);">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </section>

    <!-- Book Categories -->
    <section class="features" style="background: var(--gray-50);">
        <div class="container">
            <h2 class="section-title">
                <span class="english">Browse by Category</span>
                <span class="tamil tamil-text">பிரிவு வாரியாக பார்க்கவும்</span>
            </h2>
            
            <div class="category-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem;">
                <div class="category-card hover-lift" style="background: white; padding: 2rem; border-radius: 1rem; box-shadow: var(--shadow-lg); text-align: center; cursor: pointer;">
                    <div class="category-icon" style="width: 80px; height: 80px; background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue)); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; color: white; font-size: 2rem;">
                        <i class="fas fa-feather-alt"></i>
                    </div>
                    <h3 style="color: var(--gray-900); margin-bottom: 1rem;">Literature</h3>
                    <p style="color: var(--gray-600); margin-bottom: 1rem;">Classic and contemporary Tamil literature</p>
                    <span style="color: var(--primary-blue); font-weight: 600;">1,200+ Books</span>
                </div>
                
                <div class="category-card hover-lift" style="background: white; padding: 2rem; border-radius: 1rem; box-shadow: var(--shadow-lg); text-align: center; cursor: pointer;">
                    <div class="category-icon" style="width: 80px; height: 80px; background: linear-gradient(135deg, var(--accent-gold), var(--accent-orange)); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; color: white; font-size: 2rem;">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <h3 style="color: var(--gray-900); margin-bottom: 1rem;">Education</h3>
                    <p style="color: var(--gray-600); margin-bottom: 1rem;">Educational resources and textbooks</p>
                    <span style="color: var(--accent-gold); font-weight: 600;">800+ Books</span>
                </div>
                
                <div class="category-card hover-lift" style="background: white; padding: 2rem; border-radius: 1rem; box-shadow: var(--shadow-lg); text-align: center; cursor: pointer;">
                    <div class="category-icon" style="width: 80px; height: 80px; background: linear-gradient(135deg, var(--accent-green), #059669); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; color: white; font-size: 2rem;">
                        <i class="fas fa-theater-masks"></i>
                    </div>
                    <h3 style="color: var(--gray-900); margin-bottom: 1rem;">Culture</h3>
                    <p style="color: var(--gray-600); margin-bottom: 1rem;">Cultural traditions and practices</p>
                    <span style="color: var(--accent-green); font-weight: 600;">450+ Books</span>
                </div>
                
                <div class="category-card hover-lift" style="background: white; padding: 2rem; border-radius: 1rem; box-shadow: var(--shadow-lg); text-align: center; cursor: pointer;">
                    <div class="category-icon" style="width: 80px; height: 80px; background: linear-gradient(135deg, var(--accent-purple), #7c3aed); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; color: white; font-size: 2rem;">
                        <i class="fas fa-landmark"></i>
                    </div>
                    <h3 style="color: var(--gray-900); margin-bottom: 1rem;">History</h3>
                    <p style="color: var(--gray-600); margin-bottom: 1rem;">Tamil history and heritage</p>
                    <span style="color: #8b5cf6; font-weight: 600;">350+ Books</span>
                </div>
                
                <div class="category-card hover-lift" style="background: white; padding: 2rem; border-radius: 1rem; box-shadow: var(--shadow-lg); text-align: center; cursor: pointer;">
                    <div class="category-icon" style="width: 80px; height: 80px; background: linear-gradient(135deg, #ef4444, #dc2626); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; color: white; font-size: 2rem;">
                        <i class="fas fa-heart"></i>
                    </div>
                    <h3 style="color: var(--gray-900); margin-bottom: 1rem;">Poetry</h3>
                    <p style="color: var(--gray-600); margin-bottom: 1rem;">Classical and modern Tamil poetry</p>
                    <span style="color: var(--accent-red); font-weight: 600;">600+ Books</span>
                </div>
                
                <div class="category-card hover-lift" style="background: white; padding: 2rem; border-radius: 1rem; box-shadow: var(--shadow-lg); text-align: center; cursor: pointer;">
                    <div class="category-icon" style="width: 80px; height: 80px; background: linear-gradient(135deg, #06b6d4, #0891b2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; color: white; font-size: 2rem;">
                        <i class="fas fa-child"></i>
                    </div>
                    <h3 style="color: var(--gray-900); margin-bottom: 1rem;">Children's Books</h3>
                    <p style="color: var(--gray-600); margin-bottom: 1rem;">Stories and learning materials for kids</p>
                    <span style="color: #06b6d4; font-weight: 600;">300+ Books</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Recent Additions -->
    <section class="features">
        <div class="container">
            <h2 class="section-title">
                <span class="english">Recent Additions</span>
                <span class="tamil">புதிய நூல்கள்</span>
            </h2>
            
            <div class="books-grid" id="books-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 2rem;">
                <!-- Book entries will be populated here -->
            </div>
            
            <div style="text-align: center; margin-top: 3rem;">
                <button id="load-more" class="btn btn-primary">
                    <i class="fas fa-plus"></i>
                    Load More Books
                </button>
            </div>
        </div>
    </section>

    <!-- Reading Statistics -->
    <section class="stats">
        <div class="container">
            <h2 class="section-title" style="margin-bottom: 3rem;">
                <span class="english">Library Statistics</span>
                <span class="tamil">நூலக புள்ளிவிவரங்கள்</span>
            </h2>
            
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-number" data-target="5000">0</div>
                    <div class="stat-label">Total Books</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" data-target="500000">0</div>
                    <div class="stat-label">Downloads</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" data-target="15000">0</div>
                    <div class="stat-label">Active Readers</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" data-target="25">0</div>
                    <div class="stat-label">Languages</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-logo">
                        <img src="assets/logo.jpeg" alt="Tamil Language Society">
                        <span>தமிழ்ப் பேரவை</span>
                    </div>
                    <p>Dedicated to preserving and promoting the rich heritage of Tamil language and culture worldwide.</p>
                    <div class="social-links">
                        <a href="#" class="social-link"><i class="fab fa-facebook"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="projects.html">Projects</a></li>
                        <li><a href="ebooks.html">Ebooks</a></li>
                        <li><a href="books.html">Book Store</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>Support</h3>
                    <ul>
                        <li><a href="contact.html">Contact Us</a></li>
                        <li><a href="donate.html">Donate</a></li>
                        <li><a href="notifications.html">Notifications</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>Newsletter</h3>
                    <p>Stay updated with our latest news and events</p>
                    <div class="newsletter-form">
                        <input type="email" placeholder="Enter your email" class="newsletter-input">
                        <button class="newsletter-btn" aria-label="Subscribe to newsletter"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 Tamil Language Society. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Notification Toast -->
    <div id="notification-toast" class="notification-toast">
        <div class="toast-content">
            <i class="fas fa-bell"></i>
            <span class="toast-message"></span>
        </div>
        <button class="toast-close" onclick="closeNotification()" aria-label="Close notification">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- JavaScript -->
    <script src="js/main.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/popup-notifications.js?v=1.0"></script>
    <script src="js/slideshow.js"></script>
<script src="js/ebooks-api.js?v=2.0"></script>
    
    <script>
        // API Configuration - use window object to avoid conflicts
        // Use window.TLS_API_BASE_URL directly to avoid const declaration conflicts
        
        // Ebooks functionality
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
        });

        // Global variables
        let allEbooks = [];
        let currentBooks = [];
        let filteredBooks = [];

        async function initializePage() {
            try {
                // Load ebooks from API
                const ebooks = await window.loadEbooksFromAPI();
                console.log('Loaded ebooks:', ebooks);
                
                if (ebooks && ebooks.length > 0) {
                    allEbooks = ebooks;
                    currentBooks = ebooks.slice(0, 6);
                    filteredBooks = [...ebooks];
                    renderBooks(currentBooks);
                    console.log('Rendered', ebooks.length, 'ebooks from API');
                } else {
                    console.log('No ebooks from API, using static data');
                    // Fallback to static ebooks if API fails
                    loadStaticBooks();
                }
                
                // Initialize functionality
                initializeFilters();
                initializeSearch();
                initializeButtons();
            } catch (error) {
                console.error('Error loading ebooks:', error);
                loadStaticBooks();
            }
        }

        function loadStaticBooks() {
            // Sample book data - fallback when API is not available
            const books = [
                {
                    title: "Modern Tamil Literature",
                    tamilTitle: "நவீன தமிழ் இலக்கியம்",
                    author: "Dr. K. Rajendran",
                    category: "literature",
                    language: "bilingual",
                    rating: 4.7,
                    downloads: 2500,
                    description: "A comprehensive study of contemporary Tamil literary works",
                    color: "#2563eb"
                },
                {
                    title: "Tamil Folk Tales",
                    tamilTitle: "தமிழ் நாட்டுப்புறக் கதைகள்",
                    author: "S. Meera",
                    category: "culture",
                    language: "tamil",
                    rating: 4.5,
                    downloads: 1800,
                    description: "Collection of traditional Tamil folk stories",
                    color: "#f59e0b"
                },
                {
                    title: "Learn Tamil Grammar",
                    tamilTitle: "தமிழ் இலக்கணம் கற்றுக்கொள்ளுங்கள்",
                    author: "Prof. V. Krishnan",
                    category: "education",
                    language: "bilingual",
                    rating: 4.8,
                    downloads: 3200,
                    description: "Complete guide to Tamil grammar for beginners",
                    color: "#10b981"
                },
                {
                    title: "Tamil History Chronicles",
                    tamilTitle: "தமிழர் வரலாறு",
                    author: "Dr. A. Ramanathan",
                    category: "history",
                    language: "english",
                    rating: 4.6,
                    downloads: 1500,
                    description: "Detailed account of Tamil civilization and heritage",
                    color: "#8b5cf6"
                },
                {
                    title: "Children's Tamil Stories",
                    tamilTitle: "குழந்தைகளுக்கான தமிழ் கதைகள்",
                    author: "M. Lakshmi",
                    category: "children",
                    language: "tamil",
                    rating: 4.9,
                    downloads: 4100,
                    description: "Engaging stories for young Tamil learners",
                    color: "#06b6d4"
                },
                {
                    title: "Classical Tamil Poetry",
                    tamilTitle: "செம்மொழி தமிழின் கவிதைகள்",
                    author: "Various Authors",
                    category: "poetry",
                    language: "tamil",
                    rating: 4.4,
                    downloads: 2800,
                    description: "Anthology of classical Tamil poems",
                    color: "#ef4444"
                }
            ];

            allEbooks = books;
            currentBooks = books.slice(0, 6);
            filteredBooks = [...books];
            renderBooks(currentBooks);
            
            // Initialize functionality
            initializeFilters();
            initializeSearch();
            initializeButtons();
        }

        function renderBooks(booksToRender = currentBooks) {
                const grid = document.getElementById('books-grid');
                grid.innerHTML = '';

                booksToRender.forEach((book, index) => {
                    const bookCard = document.createElement('div');
                    bookCard.className = 'book-card hover-lift';
                    bookCard.style.animationDelay = `${index * 0.1}s`;
                    bookCard.setAttribute('data-ebook-id', book._id || book.id);
                    
                    bookCard.innerHTML = `
                        <div class="book-cover" style="height: 300px; ${getEbookImageStyle(book.image || book.coverImage || `linear-gradient(135deg, ${book.color}, ${book.color}dd)`)}; border-radius: 1rem 1rem 0 0; position: relative; overflow: hidden; cursor: pointer;">
                            <div style="position: absolute; top: 1.5rem; left: 1.5rem; right: 1.5rem; text-align: center; color: white;">
                                <h4 style="font-family: 'Noto Sans Tamil', var(--font-tamil), sans-serif; font-size: 1.25rem; margin-bottom: 0.5rem; font-weight: 600;">${book.tamilTitle || book.title}</h4>
                                <h5 style="font-size: 1rem; opacity: 0.9; margin-bottom: 1rem; font-weight: 500;">${book.title}</h5>
                                <p style="font-size: 0.9rem; opacity: 0.8;">by ${book.authorTamil || book.author}</p>
                                <div style="position: absolute; bottom: -120px; left: 50%; transform: translateX(-50%); font-size: 6rem; opacity: 0.1;">
                                    <i class="fas fa-book"></i>
                                </div>
                            </div>
                        </div>
                        <div class="book-info" style="padding: 1.5rem; background: white; border-radius: 0 0 1rem 1rem; box-shadow: var(--shadow-lg);">
                            <p style="color: var(--gray-600); font-size: 0.9rem; margin-bottom: 1rem; line-height: 1.5;">${book.description}</p>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <div class="rating" style="color: var(--accent-gold);">
                                    ${generateStars(book.rating)}
                                    <span style="margin-left: 0.5rem; color: var(--gray-600); font-size: 0.9rem;">${book.rating}</span>
                            </div>
                            <span class="download-count" style="color: var(--gray-500); font-size: 0.8rem;">${book.downloadCount || book.downloads || 0} downloads</span>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                            <button class="btn-download" data-ebook-id="${book._id || book.id}" style="flex: 1; background: ${book.color}; color: white; border: none; padding: 0.75rem; border-radius: 0.5rem; cursor: pointer; font-size: 0.9rem; transition: all 0.3s ease;">
                                <i class="fas fa-download"></i> Download
                            </button>
                            <button class="btn-rate" data-ebook-id="${book._id || book.id}" style="background: var(--accent-gold); color: white; border: none; padding: 0.75rem; border-radius: 0.5rem; cursor: pointer; font-size: 0.9rem; transition: all 0.3s ease;">
                                <i class="fas fa-star"></i>
                            </button>
                        </div>
                        </div>
                    `;
                    
                    grid.appendChild(bookCard);
                });

                // Add animation classes
                setTimeout(() => {
                    document.querySelectorAll('.book-card').forEach(card => {
                        card.classList.add('animate-fadeInUp');
                    });
                    // Validate and fix broken images
                    validateEbookImages();
                    // Load saved data after animation
                    loadSavedData();
                }, 100);
            }

        function getEbookImageStyle(image) {
            if (!image) {
                return 'background: url("assets/default-book-cover.svg") center/cover no-repeat, linear-gradient(135deg, #667eea, #764ba2);';
            }
            
            // Check if it's a gradient
            if (image.includes('gradient')) {
                return `background: ${image};`;
            }
            
            // Check if it's already a full URL
            if (image.startsWith('http://') || image.startsWith('https://')) {
                return `background: url('${image}') center/cover no-repeat, linear-gradient(135deg, #667eea, #764ba2);`;
            }
            
            // Handle relative paths from backend
            if (image.startsWith('/uploads/') || image.startsWith('uploads/')) {
                const cleanPath = image.startsWith('/') ? image : '/' + image;
                const imageUrl = `${window.TLS_API_BASE_URL || 'http://localhost:8080'}${cleanPath}`;
                return `background: url('${imageUrl}') center/cover no-repeat, linear-gradient(135deg, #667eea, #764ba2);`;
            }
            
            // Handle public paths
            if (image.startsWith('/public/') || image.startsWith('public/')) {
                const imageUrl = image.startsWith('/') ? `${window.TLS_API_BASE_URL || 'http://localhost:8080'}${image}` : `${window.TLS_API_BASE_URL || 'http://localhost:8080'}/${image}`;
                return `background: url('${imageUrl}') center/cover no-repeat, linear-gradient(135deg, #667eea, #764ba2);`;
            }
            
            // Handle default ebook cover references
            if (image === '/assets/default-book-cover.svg' || 
                image === 'assets/default-book-cover.svg' ||
                image === '/assets/images/default-ebook.svg' ||
                image === 'assets/images/default-ebook.svg') {
                return 'background: url("assets/default-book-cover.svg") center/cover no-repeat, linear-gradient(135deg, #667eea, #764ba2);';
            }
            
            // Handle standalone filename - assume it's in uploads/ebooks folder
            if (!image.includes('/') && (image.includes('.jpg') || image.includes('.jpeg') || image.includes('.png') || image.includes('.gif') || image.includes('.webp'))) {
                const imageUrl = `${window.TLS_API_BASE_URL || 'http://localhost:8080'}/uploads/ebooks/${image}`;
                return `background: url('${imageUrl}') center/cover no-repeat, linear-gradient(135deg, #667eea, #764ba2);`;
            }
            
            // Handle asset paths
            if (image.startsWith('/') || image.startsWith('assets/')) {
                return `background: url('${image}') center/cover no-repeat, linear-gradient(135deg, #667eea, #764ba2);`;
            }
            
            // Default fallback to default ebook cover
            return 'background: url("assets/default-book-cover.svg") center/cover no-repeat, linear-gradient(135deg, #667eea, #764ba2);';
        }

        function generateStars(rating) {
                const fullStars = Math.floor(rating);
                const hasHalfStar = rating % 1 !== 0;
                let stars = '';
                
                for (let i = 0; i < fullStars; i++) {
                    stars += '<i class="fas fa-star"></i>';
                }
                
                if (hasHalfStar) {
                    stars += '<i class="fas fa-star-half-alt"></i>';
                }
                
                const emptyStars = 5 - Math.ceil(rating);
                for (let i = 0; i < emptyStars; i++) {
                    stars += '<i class="far fa-star"></i>';
                }
                
                return stars;
            }

        // Image error handling function for ebooks
        function handleEbookImageError(element, ebookId) {
            console.warn(`Image failed to load for ebook ${ebookId}, using default cover`);
            const defaultStyle = 'background: url("assets/default-book-cover.svg") center/cover no-repeat, linear-gradient(135deg, #667eea, #764ba2);';
            element.style.cssText = element.style.cssText.replace(/background:[^;]+;?/, '') + defaultStyle;
        }

        // Function to validate and fix broken ebook images after rendering
        function validateEbookImages() {
            const ebookCovers = document.querySelectorAll('.book-cover');
            ebookCovers.forEach(cover => {
                const backgroundImage = getComputedStyle(cover).backgroundImage;
                if (backgroundImage && backgroundImage !== 'none') {
                    // Extract URL from background-image CSS property
                    const urlMatch = backgroundImage.match(/url\(["']?([^"'\)]+)["']?\)/);
                    if (urlMatch && urlMatch[1]) {
                        const imageUrl = urlMatch[1];
                        // Skip gradients and data URLs
                        if (!imageUrl.startsWith('data:') && !imageUrl.includes('linear-gradient')) {
                            const img = new Image();
                            img.onerror = () => {
                                console.warn(`Ebook image failed to load: ${imageUrl}`);
                                const defaultStyle = 'background: url("assets/default-book-cover.svg") center/cover no-repeat, linear-gradient(135deg, #667eea, #764ba2);';
                                cover.style.cssText = cover.style.cssText.replace(/background:[^;]+;?/, '') + defaultStyle;
                            };
                            img.src = imageUrl;
                        }
                    }
                }
            });
        }

        function initializeFilters() {
            // Filter functionality
            document.getElementById('category-filter').addEventListener('change', function() {
                filterBooks();
            });

            document.getElementById('language-filter').addEventListener('change', function() {
                filterBooks();
            });

            document.getElementById('sort-filter').addEventListener('change', function() {
                filterBooks();
            });
        }

        function filterBooks() {
            const categoryFilter = document.getElementById('category-filter').value;
            const languageFilter = document.getElementById('language-filter').value;
            const sortFilter = document.getElementById('sort-filter').value;

            let filtered = [...allEbooks];

                // Apply category filter
                if (categoryFilter !== 'all') {
                    filtered = filtered.filter(book => book.category === categoryFilter);
                }

                // Apply language filter
                if (languageFilter !== 'all') {
                    filtered = filtered.filter(book => book.language === languageFilter);
                }

                // Apply sorting
                switch (sortFilter) {
                    case 'popular':
                        filtered.sort((a, b) => b.downloads - a.downloads);
                        break;
                    case 'alphabetical':
                        filtered.sort((a, b) => a.title.localeCompare(b.title));
                        break;
                    case 'rating':
                        filtered.sort((a, b) => b.rating - a.rating);
                        break;
                    default: // latest
                        // Keep original order
                        break;
                }

                renderBooks(filtered);
            }

        function initializeSearch() {
            // Search functionality
            document.getElementById('search-input').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const filtered = allEbooks.filter(book => 
                    book.title.toLowerCase().includes(searchTerm) ||
                    (book.tamilTitle && book.tamilTitle.includes(searchTerm)) ||
                    book.author.toLowerCase().includes(searchTerm) ||
                    (book.authorTamil && book.authorTamil.includes(searchTerm)) ||
                    book.description.toLowerCase().includes(searchTerm) ||
                    (book.descriptionTamil && book.descriptionTamil.includes(searchTerm))
                );
                renderBooks(filtered);
            });
        }

        function initializeButtons() {
            // Download button functionality
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('btn-download') || e.target.parentElement.classList.contains('btn-download')) {
                    e.preventDefault();
                    const button = e.target.classList.contains('btn-download') ? e.target : e.target.parentElement;
                    handleDownload(button);
                }
                
                if (e.target.classList.contains('btn-rate') || e.target.parentElement.classList.contains('btn-rate')) {
                    e.preventDefault();
                    showRatingModal(e.target);
                }
            });

            // Load more functionality
            const loadMoreBtn = document.getElementById('load-more');
            if (loadMoreBtn) {
                loadMoreBtn.addEventListener('click', function() {
                    // Load more books from API or static data
                    const moreBooks = [...allEbooks]; // In real app, this would fetch more from server
                    currentBooks = [...currentBooks, ...moreBooks];
                    renderBooks(currentBooks);
                    if (typeof showNotification !== 'undefined') {
                        showNotification('More books loaded successfully!');
                    } else if (window.TamilSociety && window.TamilSociety.showNotification) {
                        window.TamilSociety.showNotification('More books loaded successfully!');
                    }
                });
            }
        }

        async function handleDownload(button) {
            // Check authentication before download
            if (typeof AuthUtils !== 'undefined' && !AuthUtils.isAuthenticated()) {
                AuthUtils.showAuthModal();
                return;
            }

            const bookCard = button.closest('.book-card') || button.closest('.ebook-card');
            const bookTitle = bookCard.querySelector('h4').textContent || bookCard.querySelector('h3').textContent;
            const ebookId = button.dataset.ebookId || bookCard.dataset.ebookId;
            
            if (!ebookId) {
                if (typeof showNotification !== 'undefined') {
                    showNotification('Error: Ebook ID not found', 'error');
                } else if (window.TamilSociety && window.TamilSociety.showNotification) {
                    window.TamilSociety.showNotification('Error: Ebook ID not found', 'error');
                }
                return;
            }
            
            // Show download progress
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Downloading...';
            button.disabled = true;

            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`http://localhost:8080/api/ebooks/${ebookId}/download`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    // Get updated download count from response headers
                    const downloadCount = response.headers.get('X-Download-Count');
                    
                    // Handle file download
                    const blob = await response.blob();
                    const contentDisposition = response.headers.get('Content-Disposition');
                    let filename = `${bookTitle}.pdf`;
                    
                    // Extract filename from Content-Disposition header if available
                    if (contentDisposition) {
                        const filenameMatch = contentDisposition.match(/filename="(.+)"/);
                        if (filenameMatch) {
                            filename = filenameMatch[1];
                        }
                    }
                    
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.style.display = 'none';
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                    
                    // Update download counter with real-time count from server
                    if (downloadCount) {
                        updateDownloadCountDisplay(bookCard, downloadCount);
                    }
                    
                    // Show success message
                    if (typeof showNotification !== 'undefined') {
                        showNotification(`${bookTitle} downloaded successfully! நன்றி!`);
                    } else if (window.TamilSociety && window.TamilSociety.showNotification) {
                        window.TamilSociety.showNotification(`${bookTitle} downloaded successfully! நன்றி!`);
                    }
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Download failed');
                }
            } catch (error) {
                console.error('Download error:', error);
                if (typeof showNotification !== 'undefined') {
                    showNotification(`Download failed: ${error.message}`, 'error');
                } else if (window.TamilSociety && window.TamilSociety.showNotification) {
                    window.TamilSociety.showNotification(`Download failed: ${error.message}`, 'error');
                }
            } finally {
                // Reset button
                button.innerHTML = originalText;
                button.disabled = false;
            }
        }

        // Featured carousel functionality
            let currentSlide = 0;
            const carousel = document.getElementById('featured-carousel');
            const slides = document.querySelectorAll('.ebook-card.featured');
            
            document.querySelector('.carousel-next').addEventListener('click', function() {
                currentSlide = (currentSlide + 1) % slides.length;
                updateCarousel();
            });
            
            document.querySelector('.carousel-prev').addEventListener('click', function() {
                currentSlide = (currentSlide - 1 + slides.length) % slides.length;
                updateCarousel();
            });
            
            function updateCarousel() {
                const translateX = -currentSlide * (slides[0].offsetWidth + 32); // 32px for margin
                carousel.style.transform = `translateX(${translateX}px)`;
            }

        // Auto-scroll carousel
        setInterval(() => {
            currentSlide = (currentSlide + 1) % slides.length;
            updateCarousel();
        }, 5000);

        // Download counter functionality
        function updateDownloadCountDisplay(bookCard, newCount) {
            const downloadSpan = bookCard.querySelector('.download-count');
            if (downloadSpan) {
                downloadSpan.textContent = `${newCount} downloads`;
                
                // Update all instances of this ebook's download count
                const ebookId = bookCard.dataset.ebookId;
                if (ebookId) {
                    const allDownloadSpans = document.querySelectorAll(`[data-ebook-id="${ebookId}"] .download-count`);
                    allDownloadSpans.forEach(span => {
                        span.textContent = `${newCount} downloads`;
                    });
                }
            }
        }
        
        // Function to fetch and update download count for a specific ebook
        async function refreshDownloadCount(ebookId) {
            try {
                const response = await fetch(`http://localhost:8080/api/ebooks/${ebookId}/download-count`);
                if (response.ok) {
                    const data = await response.json();
                    const bookCards = document.querySelectorAll(`[data-ebook-id="${ebookId}"]`);
                    bookCards.forEach(card => {
                        updateDownloadCountDisplay(card, data.data.downloadCount);
                    });
                }
            } catch (error) {
                console.error('Error refreshing download count:', error);
            }
        }

        // Rating modal functionality
        function showRatingModal(button) {
            const bookCard = button.closest('.book-card');
            const bookTitle = bookCard.querySelector('h4').textContent;
            
            // Create rating modal
            const modal = document.createElement('div');
            modal.className = 'rating-modal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 2rem; border-radius: 1rem; max-width: 400px; width: 90%; text-align: center;">
                    <h3 style="margin-bottom: 1rem; color: var(--gray-900);">Rate this Book</h3>
                    <p style="margin-bottom: 1.5rem; color: var(--gray-600);">${bookTitle}</p>
                    <div class="rating-stars" style="margin-bottom: 1.5rem; font-size: 2rem; color: var(--gray-300);">
                        <i class="fas fa-star" data-rating="1"></i>
                        <i class="fas fa-star" data-rating="2"></i>
                        <i class="fas fa-star" data-rating="3"></i>
                        <i class="fas fa-star" data-rating="4"></i>
                        <i class="fas fa-star" data-rating="5"></i>
                    </div>
                    <div style="display: flex; gap: 1rem; justify-content: center;">
                        <button class="submit-rating" style="background: var(--accent-gold); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 0.5rem; cursor: pointer;">Submit</button>
                        <button class="cancel-rating" style="background: var(--gray-300); color: var(--gray-700); border: none; padding: 0.75rem 1.5rem; border-radius: 0.5rem; cursor: pointer;">Cancel</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            let selectedRating = 0;
            
            // Star hover and click functionality
            const stars = modal.querySelectorAll('.rating-stars i');
            stars.forEach((star, index) => {
                star.addEventListener('mouseenter', () => {
                    stars.forEach((s, i) => {
                        s.style.color = i <= index ? 'var(--accent-gold)' : 'var(--gray-300)';
                    });
                });
                
                star.addEventListener('click', () => {
                    selectedRating = index + 1;
                    stars.forEach((s, i) => {
                        s.style.color = i < selectedRating ? 'var(--accent-gold)' : 'var(--gray-300)';
                    });
                });
            });
            
            modal.querySelector('.rating-stars').addEventListener('mouseleave', () => {
                stars.forEach((s, i) => {
                    s.style.color = i < selectedRating ? 'var(--accent-gold)' : 'var(--gray-300)';
                });
            });
            
            // Submit rating
            modal.querySelector('.submit-rating').addEventListener('click', () => {
                if (selectedRating > 0) {
                    // Store rating in localStorage
                    localStorage.setItem(`rating_${bookTitle}`, selectedRating);
                    window.TamilSociety.showNotification(`நன்றி! You rated this book ${selectedRating} stars`);
                    document.body.removeChild(modal);
                    
                    // Update the book's rating display
                    updateBookRating(bookCard, selectedRating);
                } else {
                    window.TamilSociety.showNotification('Please select a rating', 'error');
                }
            });
            
            // Cancel rating
            modal.querySelector('.cancel-rating').addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            // Close on backdrop click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
        }

        // Update book rating display
        function updateBookRating(bookCard, newRating) {
            const ratingDiv = bookCard.querySelector('.rating');
            const stars = ratingDiv.querySelectorAll('i');
            const ratingSpan = ratingDiv.querySelector('span');
            
            stars.forEach((star, index) => {
                if (index < newRating) {
                    star.className = 'fas fa-star';
                } else {
                    star.className = 'far fa-star';
                }
            });
            
            ratingSpan.textContent = newRating.toFixed(1);
        }

        // Load saved ratings and download counts on page load
        function loadSavedData() {
            document.querySelectorAll('.book-card').forEach(card => {
                const bookTitle = card.querySelector('h4').textContent;
                
                // Load saved rating
                const savedRating = localStorage.getItem(`rating_${bookTitle}`);
                if (savedRating) {
                    updateBookRating(card, parseInt(savedRating));
                }
                
                // Load saved download count
                const savedDownloads = localStorage.getItem(`download_${bookTitle}`);
                if (savedDownloads) {
                    const downloadSpan = card.querySelector('.download-count');
                    if (downloadSpan) {
                        downloadSpan.textContent = `${savedDownloads} downloads`;
                    }
                }
            });
        }

        // Authentication is automatically initialized by auth-utils.js
    </script>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- API Integration -->
    <!-- Mock API removed - using real backend API -->
    
    <!-- Content Management -->
    <script src="js/content-manager.js?v=10.0"></script>
    <script src="js/cache-buster.js?v=10.0"></script>

    <!-- Initialize Content Manager -->
    <script>
        // ContentManager is automatically initialized by content-manager.js
    </script>
    
    <!-- Theme Management -->
    <script>
        // Theme management
        let currentTheme = localStorage.getItem('theme') || 'light';
        
        function initializeTheme() {
            document.documentElement.setAttribute('data-theme', currentTheme);
            updateThemeIcon();
        }
        
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', currentTheme);
            localStorage.setItem('theme', currentTheme);
            updateThemeIcon();
        }
        
        function updateThemeIcon() {
            const icon = document.getElementById('theme-icon');
            if (icon) {
                icon.className = currentTheme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
            }
        }
        
        // Initialize theme on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeTheme();
        });
    </script>
</body>
</html>
